<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vacancy Scraper - API Tester</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #f8fafc;
    }

    .subtitle {
      color: #94a3b8;
      margin-bottom: 2rem;
    }

    .card {
      background: #1e293b;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid #334155;
      border-radius: 8px;
      background: #0f172a;
      color: #f8fafc;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      border-color: #3b82f6;
    }

    input[type="text"]::placeholder {
      color: #64748b;
    }

    button {
      padding: 0.75rem 1.5rem;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #2563eb;
    }

    button:disabled {
      background: #475569;
      cursor: not-allowed;
    }

    .api-key-group {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .api-key-group label {
      color: #94a3b8;
      font-size: 0.875rem;
    }

    .api-key-group input {
      width: 200px;
    }

    .api-key-group select {
      padding: 0.5rem 0.75rem;
      border: 2px solid #334155;
      border-radius: 6px;
      background: #0f172a;
      color: #f8fafc;
      font-size: 0.875rem;
      cursor: pointer;
    }

    .api-key-group select:focus {
      border-color: #3b82f6;
      outline: none;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .status.loading {
      background: #1e3a5f;
      color: #60a5fa;
    }

    .status.success {
      background: #14532d;
      color: #4ade80;
    }

    .status.error {
      background: #450a0a;
      color: #f87171;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #60a5fa;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .results {
      display: none;
    }

    .results.show {
      display: block;
    }

    .meta {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .meta-item {
      background: #334155;
      padding: 0.5rem 1rem;
      border-radius: 6px;
    }

    .meta-item span {
      color: #94a3b8;
      font-size: 0.75rem;
      text-transform: uppercase;
      display: block;
    }

    .meta-item strong {
      color: #f8fafc;
      font-size: 1.125rem;
    }

    .vacancy {
      background: #0f172a;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #3b82f6;
    }

    .vacancy h3 {
      color: #f8fafc;
      margin-bottom: 0.5rem;
    }

    .vacancy-meta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
      font-size: 0.875rem;
      color: #94a3b8;
    }

    .vacancy-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .vacancy p {
      color: #cbd5e1;
      font-size: 0.875rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }

    .skills {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .skill {
      background: #334155;
      color: #e2e8f0;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
    }

    .vacancy-link {
      display: inline-block;
      margin-top: 0.5rem;
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.875rem;
    }

    .vacancy-link:hover {
      text-decoration: underline;
    }

    .vacancy.has-details {
      border-left-color: #10b981;
    }

    .detail-badge {
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      background: #10b981;
      color: white;
      border-radius: 4px;
      margin-left: 0.5rem;
      vertical-align: middle;
    }

    .full-desc {
      color: #94a3b8;
      font-size: 0.875rem;
      line-height: 1.6;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #1e293b;
      border-radius: 6px;
    }

    .detail-section {
      margin-bottom: 1rem;
    }

    .detail-section strong {
      color: #e2e8f0;
      font-size: 0.875rem;
      display: block;
      margin-bottom: 0.5rem;
    }

    .detail-section ul {
      margin: 0;
      padding-left: 1.25rem;
      color: #94a3b8;
      font-size: 0.875rem;
    }

    .detail-section li {
      margin-bottom: 0.25rem;
    }

    .salary-info {
      margin: 0.75rem 0;
      padding: 0.5rem 0.75rem;
      background: #1e3a5f;
      border-radius: 6px;
      color: #60a5fa;
      font-weight: 500;
      font-size: 0.875rem;
      display: inline-block;
    }

    .no-vacancies {
      text-align: center;
      padding: 2rem;
      color: #94a3b8;
    }

    .toggle-btn {
      margin-top: 1rem;
      margin-right: 1rem;
      font-size: 0.875rem;
      color: #60a5fa;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }

    .toggle-btn:hover {
      text-decoration: underline;
    }

    .output-box {
      display: none;
      margin-top: 1rem;
      background: #0f172a;
      border-radius: 8px;
      padding: 1rem;
      overflow-x: auto;
      position: relative;
    }

    .output-box.show {
      display: block;
    }

    .output-box pre {
      color: #94a3b8;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.75rem;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .copy-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      background: #334155;
      color: #e2e8f0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .copy-btn:hover {
      background: #475569;
    }

    .copy-btn.copied {
      background: #14532d;
      color: #4ade80;
    }

    .curl-box {
      margin-bottom: 1rem;
    }

    .curl-box pre {
      color: #fbbf24;
    }

    /* Scraper selector tabs */
    .scraper-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .scraper-tab {
      padding: 0.75rem 1.25rem;
      background: #1e293b;
      border: 2px solid #334155;
      border-radius: 8px;
      color: #94a3b8;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .scraper-tab:hover {
      border-color: #475569;
      color: #e2e8f0;
    }

    .scraper-tab.active {
      background: #3b82f6;
      border-color: #3b82f6;
      color: white;
    }

    .scraper-tab.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .scraper-tab .icon {
      font-size: 1.25rem;
    }

    .scraper-tab .badge {
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      background: #475569;
      border-radius: 4px;
      text-transform: uppercase;
      font-weight: 600;
    }

    .scraper-tab.active .badge {
      background: rgba(255,255,255,0.2);
    }

    .scraper-description {
      color: #64748b;
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
      padding: 0.75rem 1rem;
      background: #1e293b;
      border-radius: 8px;
      border-left: 3px solid #3b82f6;
    }

    .scraper-panel {
      display: none;
    }

    .scraper-panel.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Scraper Platform</h1>
    <p class="subtitle">Kies een scraper en voer een domeinnaam in | <a href="/docs" style="color: #60a5fa;">API Documentatie</a></p>

    <!-- Scraper Type Selector -->
    <div class="scraper-tabs">
      <button class="scraper-tab active" data-scraper="vacancy" onclick="selectScraper('vacancy')">
        <span class="icon">üíº</span>
        <span>Vacatures</span>
      </button>
      <button class="scraper-tab" data-scraper="chatsync" onclick="selectScraper('chatsync')">
        <span class="icon">üí¨</span>
        <span>ChatSync</span>
      </button>
      <button class="scraper-tab" data-scraper="googleads" onclick="selectScraper('googleads')">
        <span class="icon">üì¢</span>
        <span>Google Ads</span>
      </button>
      <button class="scraper-tab disabled" data-scraper="company" onclick="selectScraper('company')">
        <span class="icon">üè¢</span>
        <span>Bedrijfsinfo</span>
        <span class="badge">Binnenkort</span>
      </button>
      <button class="scraper-tab disabled" data-scraper="contacts" onclick="selectScraper('contacts')">
        <span class="icon">üë•</span>
        <span>Contacten</span>
        <span class="badge">Binnenkort</span>
      </button>
      <button class="scraper-tab disabled" data-scraper="tech" onclick="selectScraper('tech')">
        <span class="icon">‚öôÔ∏è</span>
        <span>Tech Stack</span>
        <span class="badge">Binnenkort</span>
      </button>
    </div>

    <!-- Vacancy Scraper Panel -->
    <div id="panel-vacancy" class="scraper-panel active">
      <div class="scraper-description">
        Scrape vacatures van een bedrijfswebsite. Vindt automatisch de career pagina en extraheert vacature details met AI.
      </div>

      <div class="card">
        <div class="api-key-group">
          <label for="apiKey">API Key:</label>
          <input type="text" id="apiKey" value="test123" placeholder="Je API key">
        </div>

        <div class="form-group">
          <input type="text" id="domain" placeholder="bijv. coolblue.nl" autofocus>
          <button id="scrapeBtn" onclick="scrape()">Scrape</button>
        </div>

        <div class="api-key-group">
          <label for="detailLimit">Detail scraping:</label>
          <select id="detailLimit" onchange="updateCurlPreview()">
            <option value="0">Uit - alleen overzicht</option>
            <option value="3">3 vacatures in detail</option>
            <option value="5">5 vacatures in detail</option>
            <option value="10">10 vacatures in detail</option>
            <option value="20">20 vacatures in detail (max)</option>
          </select>
        </div>

        <div id="curlSection" class="curl-box output-box">
          <button class="copy-btn" onclick="copyCurl()">Kopieer</button>
          <pre id="curlCommand"></pre>
        </div>
      </div>
    </div>

    <!-- ChatSync Scraper Panel -->
    <div id="panel-chatsync" class="scraper-panel">
      <div class="scraper-description">
        Scrape een hele website voor ChatSync. Haalt content op, converteert naar markdown en levert een gestructureerde knowledge base voor je chatbot.
      </div>

      <div class="card">
        <div class="api-key-group">
          <label for="csApiKey">API Key:</label>
          <input type="text" id="csApiKey" value="test123" placeholder="Je API key">
        </div>

        <div class="form-group">
          <input type="text" id="csDomain" placeholder="bijv. example.com">
          <button id="csScrapeBtn" onclick="chatsyncScrape()">Scrape</button>
        </div>

        <div class="api-key-group">
          <label for="csMaxPages">Max pagina's:</label>
          <select id="csMaxPages" onchange="updateChatsyncCurl()">
            <option value="10">10 pagina's</option>
            <option value="20" selected>20 pagina's</option>
            <option value="30">30 pagina's</option>
            <option value="50">50 pagina's (max)</option>
          </select>
        </div>

        <div id="csCurlSection" class="curl-box output-box">
          <button class="copy-btn" onclick="copyCsCurl()">Kopieer</button>
          <pre id="csCurlCommand"></pre>
        </div>
      </div>
    </div>

    <!-- Google Ads Scraper Panel -->
    <div id="panel-googleads" class="scraper-panel">
      <div class="scraper-description">
        Scrape de Google Ads Transparency Center. Bekijk welke advertenties een bedrijf draait, inclusief formaat, impressies en targeting.
      </div>

      <div class="card">
        <div class="api-key-group">
          <label for="gaApiKey">API Key:</label>
          <input type="text" id="gaApiKey" value="test123" placeholder="Je API key">
        </div>

        <div class="form-group">
          <input type="text" id="gaDomain" placeholder="bijv. coolblue.nl">
          <button id="gaScrapeBtn" onclick="googleAdsScrape()">Scrape</button>
        </div>

        <div class="api-key-group">
          <label for="gaRegion">Regio:</label>
          <select id="gaRegion" onchange="updateGoogleAdsCurl()">
            <option value="NL" selected>NL</option>
            <option value="BE">BE</option>
            <option value="DE">DE</option>
            <option value="US">US</option>
            <option value="GB">GB</option>
            <option value="FR">FR</option>
            <option value="ES">ES</option>
            <option value="IT">IT</option>
          </select>
        </div>

        <div id="gaCurlSection" class="curl-box output-box">
          <button class="copy-btn" onclick="copyGaCurl()">Kopieer</button>
          <pre id="gaCurlCommand"></pre>
        </div>
      </div>
    </div>

    <!-- Company Info Scraper Panel (Coming Soon) -->
    <div id="panel-company" class="scraper-panel">
      <div class="scraper-description">
        Scrape bedrijfsinformatie zoals beschrijving, grootte, industrie, locaties en social media links.
      </div>
      <div class="card">
        <div class="no-vacancies">
          <p>üöß Deze scraper is nog in ontwikkeling</p>
        </div>
      </div>
    </div>

    <!-- Contacts Scraper Panel (Coming Soon) -->
    <div id="panel-contacts" class="scraper-panel">
      <div class="scraper-description">
        Vind contactgegevens en beslissers binnen een organisatie voor sales en recruitment doeleinden.
      </div>
      <div class="card">
        <div class="no-vacancies">
          <p>üöß Deze scraper is nog in ontwikkeling</p>
        </div>
      </div>
    </div>

    <!-- Tech Stack Scraper Panel (Coming Soon) -->
    <div id="panel-tech" class="scraper-panel">
      <div class="scraper-description">
        Detecteer welke technologie√´n een website gebruikt: frameworks, analytics, CMS, hosting en meer.
      </div>
      <div class="card">
        <div class="no-vacancies">
          <p>üöß Deze scraper is nog in ontwikkeling</p>
        </div>
      </div>
    </div>

    <div id="status" class="status" style="display: none;"></div>

    <div id="results" class="results">
      <div class="card">
        <div class="meta" id="meta"></div>
        <div id="vacancies"></div>
        <button class="toggle-btn" onclick="toggleCurl()">Toon cURL command</button>
        <button class="toggle-btn" onclick="toggleJson()">Toon raw JSON</button>
        <div id="curlOutput" class="output-box curl-box">
          <button class="copy-btn" onclick="copyResultCurl()">Kopieer</button>
          <pre id="curlPre"></pre>
        </div>
        <div id="jsonOutput" class="output-box">
          <button class="copy-btn" onclick="copyJson()">Kopieer</button>
          <pre id="jsonPre"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = window.location.origin;
    let lastDomain = '';
    let lastApiKey = '';
    let currentScraper = 'vacancy';

    // Scraper configurations
    const scrapers = {
      vacancy: {
        endpoint: '/api/scrape',
        name: 'Vacatures',
        enabled: true
      },
      chatsync: {
        endpoint: '/api/chatsync',
        name: 'ChatSync',
        enabled: true
      },
      googleads: {
        endpoint: '/api/google-ads',
        name: 'Google Ads',
        enabled: true
      },
      company: {
        endpoint: '/api/company',
        name: 'Bedrijfsinfo',
        enabled: false
      },
      contacts: {
        endpoint: '/api/contacts',
        name: 'Contacten',
        enabled: false
      },
      tech: {
        endpoint: '/api/tech-stack',
        name: 'Tech Stack',
        enabled: false
      }
    };

    function selectScraper(type) {
      const scraper = scrapers[type];
      if (!scraper || !scraper.enabled) return;

      // Update tabs
      document.querySelectorAll('.scraper-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-scraper="${type}"]`).classList.add('active');

      // Update panels
      document.querySelectorAll('.scraper-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.getElementById(`panel-${type}`).classList.add('active');

      // Hide results when switching
      document.getElementById('results').classList.remove('show');
      document.getElementById('status').style.display = 'none';

      currentScraper = type;
      updateCurlPreview();
    }

    document.getElementById('domain').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') scrape();
    });

    // Update curl preview when inputs change
    document.getElementById('domain').addEventListener('input', updateCurlPreview);
    document.getElementById('apiKey').addEventListener('input', updateCurlPreview);

    function generateCurlCommand(domain, apiKey, detailLimit) {
      const endpoint = scrapers[currentScraper]?.endpoint || '/api/scrape';
      const body = detailLimit > 0
        ? `{"domain": "${domain}", "detailLimit": ${detailLimit}}`
        : `{"domain": "${domain}"}`;
      return `curl -X POST "${API_URL}${endpoint}" \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer ${apiKey}" \\
  -d '${body}'`;
    }

    function updateCurlPreview() {
      const domain = document.getElementById('domain').value.trim() || 'voorbeeld.nl';
      const apiKey = document.getElementById('apiKey').value.trim() || 'YOUR_API_KEY';
      const detailLimitEl = document.getElementById('detailLimit');
      const detailLimit = detailLimitEl ? parseInt(detailLimitEl.value) : 0;
      const curl = generateCurlCommand(domain, apiKey, detailLimit);
      document.getElementById('curlCommand').textContent = curl;
      document.getElementById('curlSection').classList.add('show');
    }

    // Show curl preview on load
    updateCurlPreview();

    async function scrape() {
      const domain = document.getElementById('domain').value.trim();
      const apiKey = document.getElementById('apiKey').value.trim();

      if (!domain) {
        showStatus('Voer een domeinnaam in', 'error');
        return;
      }

      lastDomain = domain;
      lastApiKey = apiKey;

      const detailLimitEl = document.getElementById('detailLimit');
      const detailLimit = detailLimitEl ? parseInt(detailLimitEl.value) : 0;

      const btn = document.getElementById('scrapeBtn');
      btn.disabled = true;
      btn.textContent = 'Scraping...';

      const statusMsg = detailLimit > 0
        ? `Bezig met scrapen + ${detailLimit} detail pagina's... Dit kan even duren.`
        : 'Bezig met scrapen... Dit kan even duren.';
      showStatus(statusMsg, 'loading');
      document.getElementById('results').classList.remove('show');

      try {
        const endpoint = scrapers[currentScraper]?.endpoint || '/api/scrape';
        const body = { domain };
        if (detailLimit > 0) body.detailLimit = detailLimit;

        const response = await fetch(`${API_URL}${endpoint}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify(body)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Scrape mislukt');
        }

        showStatus(`Gevonden: ${data.vacancyCount} vacature(s) via ${data.source.method}`, 'success');
        showResults(data);
      } catch (error) {
        showStatus(error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Scrape';
      }
    }

    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.style.display = 'flex';
      status.className = `status ${type}`;

      if (type === 'loading') {
        status.innerHTML = `<div class="spinner"></div> ${message}`;
      } else {
        status.innerHTML = message;
      }
    }

    function showResults(data) {
      document.getElementById('results').classList.add('show');

      // Meta info
      document.getElementById('meta').innerHTML = `
        <div class="meta-item">
          <span>Domein</span>
          <strong>${data.domain}</strong>
        </div>
        <div class="meta-item">
          <span>Vacatures</span>
          <strong>${data.vacancyCount}</strong>
        </div>
        <div class="meta-item">
          <span>Platform</span>
          <strong>${data.source.platform || 'Onbekend'}</strong>
        </div>
        <div class="meta-item">
          <span>Methode</span>
          <strong>${data.source.method === 'ai' ? 'AI Extractie' : 'Parser'}</strong>
        </div>
        <div class="meta-item">
          <span>Cached</span>
          <strong>${data.cached ? 'Ja' : 'Nee'}</strong>
        </div>
      `;

      // Vacancies
      const vacanciesEl = document.getElementById('vacancies');

      if (data.vacancies.length === 0) {
        vacanciesEl.innerHTML = `
          <div class="no-vacancies">
            <p>Geen vacatures gevonden voor dit domein.</p>
          </div>
        `;
      } else {
        vacanciesEl.innerHTML = data.vacancies.map(v => `
          <div class="vacancy ${v.hasDetails ? 'has-details' : ''}">
            <h3>${v.title} ${v.hasDetails ? '<span class="detail-badge">Gedetailleerd</span>' : ''}</h3>
            <div class="vacancy-meta">
              ${v.location ? `<span>üìç ${v.location}</span>` : ''}
              ${v.type ? `<span>üíº ${v.type}</span>` : ''}
              ${v.seniority ? `<span>üìä ${v.seniority}</span>` : ''}
              ${v.department ? `<span>üè¢ ${v.department}</span>` : ''}
              ${v.remotePolicy ? `<span>üè† ${v.remotePolicy}</span>` : ''}
              ${v.daysOpen !== null ? `<span>üìÖ ${v.daysOpen} dagen open</span>` : ''}
            </div>
            ${v.description ? `<p>${v.description}</p>` : ''}
            ${v.fullDescription ? `<p class="full-desc">${v.fullDescription.substring(0, 500)}${v.fullDescription.length > 500 ? '...' : ''}</p>` : ''}
            ${v.requirements && v.requirements.length > 0 ? `
              <div class="detail-section">
                <strong>Vereisten:</strong>
                <ul>${v.requirements.map(r => `<li>${r}</li>`).join('')}</ul>
              </div>
            ` : ''}
            ${v.responsibilities && v.responsibilities.length > 0 ? `
              <div class="detail-section">
                <strong>Verantwoordelijkheden:</strong>
                <ul>${v.responsibilities.map(r => `<li>${r}</li>`).join('')}</ul>
              </div>
            ` : ''}
            ${v.benefits && v.benefits.length > 0 ? `
              <div class="detail-section">
                <strong>Arbeidsvoorwaarden:</strong>
                <ul>${v.benefits.map(b => `<li>${b}</li>`).join('')}</ul>
              </div>
            ` : ''}
            ${v.skills && v.skills.length > 0 ? `
              <div class="skills">
                ${v.skills.map(s => `<span class="skill">${s}</span>`).join('')}
              </div>
            ` : ''}
            ${v.salary ? `
              <div class="salary-info">
                üí∞ ${v.salary.min ? v.salary.min.toLocaleString() : '?'} - ${v.salary.max ? v.salary.max.toLocaleString() : '?'} ${v.salary.currency || 'EUR'} / ${v.salary.period || 'jaar'}
              </div>
            ` : ''}
            <a href="${v.url}" target="_blank" class="vacancy-link">Bekijk vacature ‚Üí</a>
          </div>
        `).join('');
      }

      // JSON output
      document.getElementById('jsonPre').textContent = JSON.stringify(data, null, 2);

      // Curl output
      const detailLimitEl = document.getElementById('detailLimit');
      const detailLimit = detailLimitEl ? parseInt(detailLimitEl.value) : 0;
      document.getElementById('curlPre').textContent = generateCurlCommand(lastDomain, lastApiKey, detailLimit);
    }

    function toggleJson() {
      document.getElementById('jsonOutput').classList.toggle('show');
    }

    function toggleCurl() {
      document.getElementById('curlOutput').classList.toggle('show');
    }

    async function copyToClipboard(text, btn) {
      try {
        await navigator.clipboard.writeText(text);
        btn.textContent = 'Gekopieerd!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Kopieer';
          btn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Kopi√´ren mislukt:', err);
      }
    }

    function copyCurl() {
      const curl = document.getElementById('curlCommand').textContent;
      copyToClipboard(curl, event.target);
    }

    function copyResultCurl() {
      const curl = document.getElementById('curlPre').textContent;
      copyToClipboard(curl, event.target);
    }

    function copyJson() {
      const json = document.getElementById('jsonPre').textContent;
      copyToClipboard(json, event.target);
    }

    // === ChatSync Functions ===

    document.getElementById('csDomain').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') chatsyncScrape();
    });
    document.getElementById('csDomain').addEventListener('input', updateChatsyncCurl);
    document.getElementById('csApiKey').addEventListener('input', updateChatsyncCurl);

    function generateChatsyncCurl(domain, apiKey, maxPages) {
      const body = maxPages !== 20
        ? `{"domain": "${domain}", "maxPages": ${maxPages}}`
        : `{"domain": "${domain}"}`;
      return `curl -X POST "${API_URL}/api/chatsync" \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer ${apiKey}" \\
  -d '${body}'`;
    }

    function updateChatsyncCurl() {
      const domain = document.getElementById('csDomain').value.trim() || 'voorbeeld.nl';
      const apiKey = document.getElementById('csApiKey').value.trim() || 'YOUR_API_KEY';
      const maxPages = parseInt(document.getElementById('csMaxPages').value);
      const curl = generateChatsyncCurl(domain, apiKey, maxPages);
      document.getElementById('csCurlCommand').textContent = curl;
      document.getElementById('csCurlSection').classList.add('show');
    }

    function copyCsCurl() {
      const curl = document.getElementById('csCurlCommand').textContent;
      copyToClipboard(curl, event.target);
    }

    async function chatsyncScrape() {
      const domain = document.getElementById('csDomain').value.trim();
      const apiKey = document.getElementById('csApiKey').value.trim();
      const maxPages = parseInt(document.getElementById('csMaxPages').value);

      if (!domain) {
        showStatus('Voer een domeinnaam in', 'error');
        return;
      }

      lastDomain = domain;
      lastApiKey = apiKey;

      const btn = document.getElementById('csScrapeBtn');
      btn.disabled = true;
      btn.textContent = 'Scraping...';

      showStatus(`Bezig met scrapen van ${domain} (max ${maxPages} pagina's)... Dit kan even duren.`, 'loading');
      document.getElementById('results').classList.remove('show');

      try {
        const response = await fetch(`${API_URL}/api/chatsync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({ domain, maxPages })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'ChatSync scrape mislukt');
        }

        showStatus(`Gevonden: ${data.pageCount} pagina's van ${data.domain}`, 'success');
        showChatsyncResults(data);
      } catch (error) {
        showStatus(error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Scrape';
      }
    }

    function showChatsyncResults(data) {
      document.getElementById('results').classList.add('show');

      // Meta info
      document.getElementById('meta').innerHTML = `
        <div class="meta-item">
          <span>Domein</span>
          <strong>${data.domain}</strong>
        </div>
        <div class="meta-item">
          <span>Pagina's</span>
          <strong>${data.pageCount}</strong>
        </div>
        <div class="meta-item">
          <span>Cached</span>
          <strong>${data.cached ? 'Ja' : 'Nee'}</strong>
        </div>
      `;

      // Pages
      const vacanciesEl = document.getElementById('vacancies');

      if (data.pages.length === 0) {
        vacanciesEl.innerHTML = `
          <div class="no-vacancies">
            <p>Geen pagina's gevonden voor dit domein.</p>
          </div>
        `;
      } else {
        vacanciesEl.innerHTML = data.pages.map(page => `
          <div class="vacancy">
            <h3>${escapeHtml(page.title)} <span class="skill">${page.page_type}</span></h3>
            <div class="vacancy-meta">
              <span>${escapeHtml(page.url)}</span>
            </div>
            ${page.meta_description ? `<p><em>${escapeHtml(page.meta_description)}</em></p>` : ''}
            <p>${escapeHtml(page.content.substring(0, 300))}${page.content.length > 300 ? '...' : ''}</p>
            ${page.headings && page.headings.length > 0 ? `
              <div class="skills">
                ${page.headings.slice(0, 8).map(h => `<span class="skill">${escapeHtml(h)}</span>`).join('')}
              </div>
            ` : ''}
            <a href="${page.url}" target="_blank" class="vacancy-link">Bekijk pagina</a>
          </div>
        `).join('');
      }

      // JSON output
      document.getElementById('jsonPre').textContent = JSON.stringify(data, null, 2);

      // Curl output
      const maxPages = parseInt(document.getElementById('csMaxPages').value);
      document.getElementById('curlPre').textContent = generateChatsyncCurl(lastDomain, lastApiKey, maxPages);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Init ChatSync curl preview
    updateChatsyncCurl();

    // === Google Ads Functions ===

    document.getElementById('gaDomain').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') googleAdsScrape();
    });
    document.getElementById('gaDomain').addEventListener('input', updateGoogleAdsCurl);
    document.getElementById('gaApiKey').addEventListener('input', updateGoogleAdsCurl);
    document.getElementById('gaRegion').addEventListener('change', updateGoogleAdsCurl);

    function generateGoogleAdsCurl(domain, apiKey, region) {
      const body = region !== 'NL'
        ? `{"domain": "${domain}", "region": "${region}"}`
        : `{"domain": "${domain}"}`;
      return `curl -X POST "${API_URL}/api/google-ads" \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer ${apiKey}" \\
  -d '${body}'`;
    }

    function updateGoogleAdsCurl() {
      const domain = document.getElementById('gaDomain').value.trim() || 'voorbeeld.nl';
      const apiKey = document.getElementById('gaApiKey').value.trim() || 'YOUR_API_KEY';
      const region = document.getElementById('gaRegion').value;
      const curl = generateGoogleAdsCurl(domain, apiKey, region);
      document.getElementById('gaCurlCommand').textContent = curl;
      document.getElementById('gaCurlSection').classList.add('show');
    }

    function copyGaCurl() {
      const curl = document.getElementById('gaCurlCommand').textContent;
      copyToClipboard(curl, event.target);
    }

    async function googleAdsScrape() {
      const domain = document.getElementById('gaDomain').value.trim();
      const apiKey = document.getElementById('gaApiKey').value.trim();
      const region = document.getElementById('gaRegion').value;

      if (!domain) {
        showStatus('Voer een domeinnaam in', 'error');
        return;
      }

      lastDomain = domain;
      lastApiKey = apiKey;

      const btn = document.getElementById('gaScrapeBtn');
      btn.disabled = true;
      btn.textContent = 'Scraping...';

      showStatus(`Bezig met ophalen van Google Ads voor ${domain} (regio: ${region})... Dit kan even duren.`, 'loading');
      document.getElementById('results').classList.remove('show');

      try {
        const body = { domain };
        if (region !== 'NL') body.region = region;

        const response = await fetch(`${API_URL}/api/google-ads`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify(body)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Google Ads scrape mislukt');
        }

        const adCount = data.ads ? data.ads.length : 0;
        showStatus(`Gevonden: ${adCount} advertentie(s) voor ${data.domain}`, 'success');
        showGoogleAdsResults(data);
      } catch (error) {
        showStatus(error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Scrape';
      }
    }

    function showGoogleAdsResults(data) {
      document.getElementById('results').classList.add('show');

      // Meta info
      const advertiser = data.advertiser;
      const adCountRange = advertiser?.adCountRange;
      const adCount = data.ads ? data.ads.length : 0;

      document.getElementById('meta').innerHTML = `
        <div class="meta-item">
          <span>Domein</span>
          <strong>${escapeHtml(data.domain)}</strong>
        </div>
        <div class="meta-item">
          <span>Regio</span>
          <strong>${escapeHtml(data.region || 'NL')}</strong>
        </div>
        ${advertiser ? `
        <div class="meta-item">
          <span>Adverteerder</span>
          <strong>${escapeHtml(advertiser.name || 'Onbekend')}</strong>
        </div>
        <div class="meta-item">
          <span>Verificatie</span>
          <strong>${escapeHtml(advertiser.verificationStatus || 'Onbekend')}</strong>
        </div>
        ` : ''}
        ${adCountRange && adCountRange.low ? `
        <div class="meta-item">
          <span>Geschat totaal</span>
          <strong>${adCountRange.low.toLocaleString()} - ${adCountRange.high.toLocaleString()}</strong>
        </div>
        ` : ''}
        <div class="meta-item">
          <span>Opgehaald</span>
          <strong>${adCount}</strong>
        </div>
        <div class="meta-item">
          <span>Cached</span>
          <strong>${data.cached ? 'Ja' : 'Nee'}</strong>
        </div>
      `;

      // Ads list
      const vacanciesEl = document.getElementById('vacancies');

      if (!advertiser) {
        vacanciesEl.innerHTML = `
          <div class="no-vacancies">
            <p>Geen adverteerder gevonden voor dit domein.</p>
          </div>
        `;
      } else if (!data.ads || data.ads.length === 0) {
        vacanciesEl.innerHTML = `
          <div class="no-vacancies">
            <p>Geen advertenties gevonden voor dit domein.</p>
          </div>
        `;
      } else {
        vacanciesEl.innerHTML = data.ads.map(ad => {
          const formatColors = { text: '#3b82f6', image: '#10b981', video: '#8b5cf6' };
          const formatColor = formatColors[ad.format] || '#64748b';

          let impressionsHtml = '';
          if (ad.impressions) {
            const low = ad.impressions.low ? ad.impressions.low.toLocaleString() : '?';
            const high = ad.impressions.high ? ad.impressions.high.toLocaleString() : '?';
            const platformsStr = ad.impressions.platforms && ad.impressions.platforms.length > 0
              ? ad.impressions.platforms.map(p => `${escapeHtml(p.name)}: ${p.low ? p.low.toLocaleString() : '?'} - ${p.high ? p.high.toLocaleString() : '?'}`).join(', ')
              : '';
            impressionsHtml = `<p style="color: #94a3b8; font-size: 0.875rem;">
              Impressies: ${low} - ${high}
              ${platformsStr ? `<br>Platformen: ${platformsStr}` : ''}
            </p>`;
          }

          let targetingHtml = '';
          if (ad.targeting) {
            const methods = [];
            if (ad.targeting.demographics) methods.push('Demographics');
            if (ad.targeting.geographic) methods.push('Geographic');
            if (ad.targeting.contextual) methods.push('Contextual');
            if (ad.targeting.customerLists) methods.push('Customer Lists');
            if (methods.length > 0) {
              targetingHtml = `<div class="skills" style="margin-top: 0.5rem;">
                ${methods.map(m => `<span class="skill">üéØ ${m}</span>`).join('')}
              </div>`;
            }
          }

          return `
            <div class="vacancy">
              <h3>
                <span class="skill" style="background: ${formatColor}; color: white;">${escapeHtml(ad.format || 'unknown')}</span>
                ${ad.advertiserName ? escapeHtml(ad.advertiserName) : ''}
              </h3>
              <div class="vacancy-meta">
                ${ad.domain ? `<span>üåê ${escapeHtml(ad.domain)}</span>` : ''}
                ${ad.firstShown ? `<span>üìÖ Eerste vertoning: ${new Date(ad.firstShown).toLocaleDateString('nl-NL')}</span>` : ''}
                ${ad.lastShown ? `<span>üìÖ Laatste vertoning: ${new Date(ad.lastShown).toLocaleDateString('nl-NL')}</span>` : ''}
                ${ad.daysActive !== undefined ? `<span>‚è± ${ad.daysActive} dagen actief</span>` : ''}
              </div>
              ${impressionsHtml}
              ${ad.topic ? `<div class="skills" style="margin-top: 0.5rem;"><span class="skill">${escapeHtml(ad.topic)}</span></div>` : ''}
              ${targetingHtml}
              ${ad.contentUrl ? `<a href="${ad.contentUrl}" target="_blank" class="vacancy-link">Bekijk advertentie &rarr;</a>` : ''}
            </div>
          `;
        }).join('');
      }

      // JSON output
      document.getElementById('jsonPre').textContent = JSON.stringify(data, null, 2);

      // Curl output
      const region = document.getElementById('gaRegion').value;
      document.getElementById('curlPre').textContent = generateGoogleAdsCurl(lastDomain, lastApiKey, region);
    }

    // Init Google Ads curl preview
    updateGoogleAdsCurl();
  </script>
</body>
</html>
